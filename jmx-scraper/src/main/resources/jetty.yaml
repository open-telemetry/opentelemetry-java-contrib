---

rules:

  - bean: org.eclipse.jetty.io:context=*,type=managedselector,id=*
    mapping:
      selectCount:
        metric: jetty.select.count
        type: counter
        unit: "{operations}"
        desc: The number of select calls.

  - bean: org.eclipse.jetty.server.session:context=*,type=sessionhandler,id=*
    prefix: jetty.session.
    metricAttribute:
      resource: param(context)
    mapping:
      sessionsCreated:
        metric: count
        type: counter
        unit: "{sessions}"
        desc: The number of sessions established in total.
      sessionTimeTotal:
        metric: time.total
        type: counter
        unit: s
        desc: The total time sessions have been active.
      sessionTimeMax:
        metric: time.max
        # here a 'counter' metric type would suit better, but gauge reflects
        # how it's currently implemented in jetty.groovy
        type: gauge
        unit: s
        desc: The maximum amount of time a session has been active.

  - bean: org.eclipse.jetty.util.thread:type=queuedthreadpool,id=*
    prefix: jetty.thread.
    unit: "{threads}"
    mapping:
      busyThreads:
        metric: count
        desc: The current number of threads.
        metricAttribute:
          state: const(busy)
      idleThreads:
        metric: count
        desc: The current number of threads.
        metricAttribute:
          state: const(idle)
